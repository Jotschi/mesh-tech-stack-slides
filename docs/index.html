<html>
	<head>
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/syntax.css">
		<link rel="stylesheet" href="css/theme/black.css">
		<title>Gentics Mesh Workshop</title>
	</head>
	<body>
		<div id="preamble">
<div class="sectionbody">
<div class="reveal">
	<div class="slides">
<section>
<h2>Building a Java headless CMS in 2018 using Vert.x</h2>

<p>by</p>
<p>Johannes Sch√ºth</p>
<p>Lead Developer of Gentics Mesh</p>

</section>
<section>
<h2>Gentics Mesh</h2>
<div class="ulist">
<ul>
<li>
<p>Started in 11/2014</p>
</li>
<li>
<p>First public release 04/2016</p>
</li>
<li>
<p>Open source since 07/2016</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/github-graph.png" alt="github graph">
</div>
</div>
</section>
<section>
<h2>Headless CMS - Intro</h2>
<div class="ulist">
<ul>
<li>
<p>back-end only CMS</p>
</li>
<li>
<p>Contents can be accessed via RESTful API</p>
</li>
</ul>
</div>
</section>
<section>
<h2>Headless CMS - Requirements</h2>
<div class="ulist">
<ul>
<li>
<p>binary storage</p>
</li>
<li>
<p>searchable contents</p>
</li>
<li>
<p>image resizing</p>
</li>
<li>
<p>manage contents in tree structures</p>
</li>
<li>
<p>versioning</p>
</li>
<li>
<p>link handling</p>
</li>
</ul>
</div>
</section>
<section>
<h1>Gentics Mesh Technology Stack</h1>
</section>
<section>
<h2><span class="component">Technology Stack</span> - Requirements</h2>
<div class="ulist">
<ul>
<li>
<p>Lightweight and modern web framework</p>
</li>
<li>
<p>Embeddable Graph Database</p>
</li>
<li>
<p>Contents must be searchable</p>
</li>
</ul>
</div>
	<aside class="notes">
		* Compare to older stacks (e.g. Java EE?)
	</aside>
</section>
<section>
<h2><span class="component">Technology Stack</span> - 2018</h2>
<div class="ulist">
<ul>
<li>
<p>Eclipse Vert.x</p>
</li>
<li>
<p>OrientDB Graph Database</p>
</li>
<li>
<p>Elasticsearch</p>
</li>
<li>
<p>Dagger2</p>
</li>
<li>
<p>RxJava2</p>
</li>
<li>
<p>GraphQL</p>
</li>
<li>
<p>Hazelcast</p>
</li>
</ul>
</div>
	<aside class="notes">
		* Vert.x for HTTP
		* OrientDB for Storage
		* Elasticsearch for Search
		* Dagger2 for DI
		* RxJava2 for Clean RX code
		* GraphQL Java for querying data
		* Hazelcast for Clustering
	</aside>
</section>
<section>
<h1>Eclipse Vert.x</h1>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Intro</span></h2>
<div class="paragraph">
<p><a href="http://vertx.io" class="bare">http://vertx.io</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Swiss army knife for HTTP</p>
</li>
<li>
<p>Reactive Framework</p>
</li>
<li>
<p>Async API</p>
</li>
<li>
<p>Modular / General purpose</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Web</h2>
<div class="ulist">
<ul>
<li>
<p>HTTP routing</p>
</li>
<li>
<p>Session, Cookie, Upload handling</p>
</li>
<li>
<p>Websockets</p>
</li>
<li>
<p>Authentication handlers</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Vertx vertx = Vertx.vertx();

Router router = Router.router(vertx);

router.route("/hello").handler(rc -&gt; {
	rc.response().end("World");
});

vertx.createHttpServer()
	.requestHandler(router::accept)
	.listen(8080);</code></pre>
</div>
</div>
    <aside class="notes">
        * Similar to express
        * Routing requests
    </aside>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Routing</h2>
<div class="ulist">
<ul>
<li>
<p>Sub-routers to modularize and re-use routes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Router router = Router.router(vertx);

Router subRouter = Router.router(vertx);
router.mountSubRouter("/test/", subRouter);

subRouter.route("/hello").handler(rc -&gt; {
	rc.response().end("World");
});</code></pre>
</div>
</div>
    <aside class="notes">
     * subrouters great to modularize and reuse routes
    </aside>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Verticles</h2>
<div class="paragraph">
<p>Deployable from/via:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven</p>
</li>
<li>
<p>Fully qualified class name</p>
</li>
<li>
<p>Jar</p>
</li>
<li>
<p>Instances</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public static void main(String[] args) {
	Vertx vertx = Vertx.vertx();
	vertx.deployVerticle(new TestVerticle());
}</code></pre>
</div>
</div>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Verticles</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">class TestVerticle extends AbstractVerticle {

	private static final Logger log = LoggerFactory
		.getLogger(TestVerticle.class);

	@Override
	public void start(Future&lt;Void&gt; startFuture) throws Exception {
		log.info("Started");
		startFuture.complete();
	}

	@Override
	public void stop(Future&lt;Void&gt; stopFuture) throws Exception {
		log.info("Stopped");
		stopFuture.complete();
	}</code></pre>
</div>
</div>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Pitfalls #1</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">for (int i = 0; i &lt; 10000; i++) {
	Vertx.vertx();
}</code></pre>
</div>
</div>
<span class="fragment">
  <img src="images/vertx-thread-bomb.png" alt="vertx thread bomb">
  <p>Each Vert.x instance creates its own threadpool</p>
</span>
    <aside class="notes">
		* Each Vert.x instance creates eventloop, worker thread pool
    </aside>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Pitfalls #2</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">final String ADDR = "dummy";
Vertx vertx = Vertx.vertx();
EventBus bus = vertx.eventBus();

bus.consumer(ADDR, rh -&gt; {
	bus.publish(ADDR, "hello-world");
	bus.publish(ADDR, "hello-world");
});

bus.publish(ADDR, "hello-world");</code></pre>
</div>
</div>
<span class="fragment">
    <img src="images/vertx-eventbus-bomb.png" alt="vertx eventbus bomb">
</span>
    <aside class="notes">
        * Eventbus loops can cause problems
    </aside>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Pitfalls #3</h2>
<div class="ulist">
<ul>
<li>
<p>Vert.x is very flexible</p>
</li>
<li>
<p>Multiple ways to setup a REST API project</p>
</li>
</ul>
</div>
    <aside class="notes">
        * Issues sometimes are only revealed under load
    </aside>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Pitfalls #3</h2>
<div class="ulist">
<ul>
<li>
<p>Routes are setup once and shared for all verticles</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/vertx-rest-setup-wrong.png" alt="vertx rest setup wrong">
</div>
</div>
    <aside class="notes">
        * Multiple verticles to process request concurrently
    </aside>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Pitfalls #3</h2>
<div class="ulist">
<ul>
<li>
<p>Routes are setup once and shared for all verticles</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/vertx-rest-setup-wrong-cross.png" alt="vertx rest setup wrong cross">
</div>
</div>
    <aside class="notes">
        * Each verticle has its own eventloop
        * Thus handlers may be invoked concurrently
        * Shared classes/handlers may not be threadsafe
    </aside>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Pitfalls #3</h2>
<div class="imageblock">
<div class="content">
<img src="images/vertx-rest-setup.png" alt="vertx rest setup">
</div>
</div>
    <aside class="notes">
    </aside>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Pitfalls #3</h2>
<div class="paragraph">
<p>Full example on GitHub:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/Jotschi/vertx-router-example" class="bare">https://github.com/Jotschi/vertx-router-example</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RouterStorage</code> class used to collectively manage routes</p>
</li>
</ul>
</div>
    <aside class="notes">
    </aside>
</section>
<section>
<h2><span class="component">Eclipse Vert.x</span> - Pitfalls</h2>
<div class="ulist">
<ul>
<li>
<p>Blocking the eventloop</p>
</li>
<li>
<p>Blocking the worker pool</p>
</li>
<li>
<p>Forgetting about open file handles</p>
</li>
<li>
<p>Vertx-web sharing routers between verticles</p>
</li>
<li>
<p>Using verticles to structure endpoints</p>
</li>
<li>
<p>Sharing the Vert.x webclient between verticles</p>
</li>
<li>
<p>Blocking in the executeBlocking result handler</p>
</li>
</ul>
</div>
</section>
<section>
<h1>RxJava2</h1>
</section>
<section>
<h2><span class="component">RxJava2</span></h2>
<div class="paragraph">
<p><a href="https://github.com/ReactiveX/RxJava" class="bare">https://github.com/ReactiveX/RxJava</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reactive Extensions for the JVM</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">RxJava2</span> - Chaining Requests</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">MeshRestClient client = MeshRestClient.create("localhost", Vertx.vertx());

List&lt;String&gt; names = Arrays.asList("Iron Man",
	"Captain America", "Star Lord",
	"Black Widow", "Hulk");

client.findProjectByName("MCU").toSingle().flatMapCompletable(project -&gt; {
	return Observable.fromIterable(names).flatMapSingle(name -&gt; {

		NodeCreateRequest request = new NodeCreateRequest();
		request.setParentNodeUuid(project.getRootNode().getUuid());
		request.setLanguage("en");

		return client.createNode("MCU", request).toSingle();
	}).ignoreElements();
}).subscribe();</code></pre>
</div>
</div>
</section>
<section>
<h2><span class="component">RxJava2</span> - Vert.x</h2>
<div class="paragraph">
<p>Direct integration with Vert.x via</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.vertx&lt;/groupId&gt;
    &lt;artifactId&gt;vertx-rx-java2&lt;/artifactId&gt;
    &lt;version&gt;3.5.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import io.vertx.reactivex.core.Vertx;
‚Ä¶
Vertx vertx = Vertx.vertx();</code></pre>
</div>
</div>
</section>
<section>
<h1>GraphQL</h1>
</section>
<section>
<h2><span class="component">GraphQL</span> - Intro</h2>
<div class="ulist">
<ul>
<li>
<p>Query language used to query nested data structures</p>
</li>
<li>
<p>First released 2015</p>
</li>
<li>
<p>Developed by Facebook</p>
</li>
<li>
<p>Alternative to REST</p>
</li>
</ul>
</div>
    <aside class="notes">
        * Describe data domain via schema
        * Use query to ask for data
        * Get data which matches the query
    </aside>
</section>
<section>
<h2><span class="component">GraphQL</span> - Query</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">{
  node(path: "/aircrafts/space-shuttle") {
    uuid
    fields {
      ... on vehicle {
        weight
        price
        slug
        description
      }
    }
  }
}</code></pre>
</div>
</div>
    <aside class="notes">
      * Typical Gentics Mesh query
      * We query for weight, price, slug and description
      * Union types can be used to handle dynamic results
    </aside>
</section>
<section>
<h2><span class="component">GraphQL</span> - Result</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">{
  "data": {
    "node": {
      "uuid": "f915b16fa68f40e395b16fa68f10e32d",
      "fields": {
        "weight": 22700,
        "price": 192000000000,
        "slug": "space-shuttle",
        "description": "The Space Shuttle was a partially reusable
         low Earth orbital spacecraft system operated by the U.S.
         National Aeronautics and Space Administration (NASA)."
      }
    }
  }
}</code></pre>
</div>
</div>
    <aside class="notes">
      * Result data similar to query
    </aside>
</section>
<section>
<h2><span class="component">GraphQL</span> - GraphiQL</h2>
<div class="ulist">
<ul>
<li>
<p>demo.getmesh.io/api/v1/demo/graphql/browser</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/graphiql.png" alt="graphiql">
</div>
</div>
    <aside class="notes">
        * Convenient way to explore GraphQL schema
    </aside>
</section>
<section>
<h2><span class="component">GraphQL</span> - Choice</h2>
<div class="paragraph">
<p>Solves problems</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Overfetching</p>
</li>
<li>
<p>Underfetching</p>
</li>
<li>
<p>Loading deeply nested data structures</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - Underfetching</h2>
<div class="paragraph">
<p>The response of the server is lacking information you need</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#8594; Execute additional requests to load the data</p>
</li>
<li>
<p>&#8594; Causes additional delays</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - Overfetching</h2>
<div class="paragraph">
<p>The response of the server contains more information then you need</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#8594; The data superfluous data still needs to be loaded</p>
</li>
<li>
<p>&#8594; Causes additional delays and load on the system</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - Pitfalls</h2>
<div class="ulist">
<ul>
<li>
<p>Caching responses is not that easy</p>
</li>
<li>
<p>Error handling done via JSON</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - GraphQL-Java</h2>
<div class="ulist">
<ul>
<li>
<p>Java API to create GraphQL schema</p>
</li>
<li>
<p>Github: github.com/graphql-java/graphql-java</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
    &lt;artifactId&gt;graphql-java&lt;/artifactId&gt;
    &lt;version&gt;8.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - Domain Model</h2>
<div class="paragraph">
<p>RootElement references Demo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class RootElement {

	private final Demo demo;

	public RootElement(Demo demo) {
		this.demo = demo;
	}

	public Demo getDemo() {
		return demo;
	}
}</code></pre>
</div>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - Domain Model</h2>
<div class="paragraph">
<p>Demo object contains <code>id</code> and <code>name</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class Demo {

	private final String name;
	private final String id;

	public Demo(String id, String name) {
		this.id = id;
		this.name = name;
	}

	public String getName() {
		return name;
	}

	public String getId() {
		return id;
	}
}</code></pre>
</div>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - Schema #1</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public static GraphQLSchema createSchema() {
	return GraphQLSchema.newSchema()
		.query(createQueryType())
		.build();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private static GraphQLObjectType createDemoType() {
	return newObject().name("Demo")
		.description("A demo element")

		// .id
		.field(newFieldDefinition().name("id")
			.description("The id of the character.")
			.type(new GraphQLNonNull(GraphQLString)))

		// .name
		.field(newFieldDefinition().name("name")
			.description("The name of the element.")
			.type(GraphQLString))

		.build();
}</code></pre>
</div>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - Schema #2</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private static GraphQLObjectType createQueryType() {
	return newObject().name("QueryType")

		// .demo
		.field(newFieldDefinition().name("demo")
			.type(createDemoType())
			.dataFetcher((env) -&gt; {
				RootElement root = env.getSource();
				return root.getDemo();
			}))

		.build();
}</code></pre>
</div>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - Query</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">		// .demo
		.field(newFieldDefinition().name("demo")
			.type(createDemoType())
			.dataFetcher((env) -&gt; {
				RootElement root = env.getSource();
				return root.getDemo();
			}))

		.build();
}

private static GraphQLObjectType createDemoType() {
	return newObject().name("Demo")
		.description("A demo element")

		// .id
		.field(newFieldDefinition().name("id")
			.description("The id of the character.")
			.type(new GraphQLNonNull(GraphQLString)))

		// .name
		.field(newFieldDefinition().name("name")
			.description("The name of the element.")
			.type(GraphQLString))</code></pre>
</div>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - GraphDB Traversal</h2>
<div class="ulist">
<ul>
<li>
<p>Root element is starting point of query</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">RootElement root = ‚Ä¶
new ExecutionInput(query, null, queryJson, rootElement, null);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data fetchers can load directly referenced data</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">‚Ä¶
.dataFetcher((env) -&gt; {
    RootElement root = env.getSource();
    return root.getDemo();
}))
‚Ä¶</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>GraphQL thus directly traversals the GraphDB via data fetchers</p>
</li>
<li>
<p>Highly efficient</p>
</li>
<li>
<p>Convenient for profiling</p>
</li>
</ul>
</div>
    <aside class="notes">
        * Elements which were visited in the transaction will be cached
        * GraphDB domain model can be mapped to GraphQL schemas
    </aside>
</section>
<section>
<h2><span class="component">GraphQL</span> - Profiling</h2>
<div class="ulist">
<ul>
<li>
<p>CPU profiling very convenient</p>
</li>
<li>
<p>JProfiler example</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/graphql-profiling.png" alt="graphql profiling">
</div>
</div>
</section>
<section>
<h2><span class="component">GraphQL</span> - Examples</h2>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/Jotschi/vertx-graphql-example" class="bare">https://github.com/Jotschi/vertx-graphql-example</a></p>
</li>
<li>
<p><a href="https://github.com/graphql-java/graphql-java/blob/master/src/test/groovy/graphql/GarfieldSchema.java" class="bare">https://github.com/graphql-java/graphql-java/blob/master/src/test/groovy/graphql/GarfieldSchema.java</a></p>
</li>
</ul>
</div>
    <aside class="notes">
        * Example shows argument handling
        * Integration with OrientDB
        * Integration with Vert.x
        * Error handling
    </aside>
</section>
<section>
<h1>Elasticsearch</h1>
</section>
<section>
<h2><span class="component">Elasticsearch</span> - Intro</h2>
<div class="ulist">
<ul>
<li>
<p>Java based</p>
</li>
<li>
<p>Highly scaleable</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">Elasticsearch</span> - Mesh</h2>
<div class="ulist">
<ul>
<li>
<p><strong>Store</strong> mesh elements in indices (Users, Nodes, Groups)</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">Elasticsearch</span> - Pitfalls</h2>
<div class="ulist">
<ul>
<li>
<p>Dynamic mapping can cause issues when input data is dynamic</p>
</li>
<li>
<p>Index types are gradually being deprecated</p>
</li>
</ul>
</div>
    <aside class="notes">
        * Document property switches from string to number
        * Dynamic mappings on by-default
    </aside>
</section>
<section>
<h2><span class="component">Elasticsearch</span> - Syncing</h2>
<div class="paragraph">
<p>Differential sync per index</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assign hashsum to each document</p>
</li>
<li>
<p>Collect hashsums of all elements in the graph</p>
</li>
<li>
<p>Collect hashsums of all elements in the index</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">Elasticsearch</span> - Syncing</h2>
<div class="ulist">
<ul>
<li>
<p>Compare using Google Guava:</p>
</li>
<li>
<p><code>com.google.common.collect.Maps#difference</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Map&lt;String, String&gt; sourceVersions = loadVersionsFromGraph();

Map&lt;String, String&gt; sinkVersions = loadVersionsFromIndex(indexName);
MapDifference&lt;String, String&gt; diff = Maps.difference(sourceVersions,
                                       sinkVersions);

Set&lt;String&gt; needInsertionInES = diff.entriesOnlyOnLeft().keySet();
Set&lt;String&gt; needRemovalInES = diff.entriesOnlyOnRight().keySet();
Set&lt;String&gt; needUpdate = diff.entriesDiffering().keySet();</code></pre>
</div>
</div>
</section>
<section>
<h1>GraphDB</h1>
</section>
<section>
<h2><span class="component">GraphDB</span></h2>
<div class="ulist">
<ul>
<li>
<p>Embeddable</p>
</li>
<li>
<p>Direct vendor support for Tinkerpop API</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">GraphDB</span> - Stack</h2>
<div class="imageblock">
<div class="content">
<img src="images/graph-stack.png" alt="graph stack">
</div>
</div>
</section>
<section>
<h2><span class="component">GraphDB</span> - Apache Tinkerpop</h2>
<div class="ulist">
<ul>
<li>
<p>Open Source</p>
</li>
<li>
<p>Vendor Agnostic API</p>
</li>
<li>
<p>Supported by many graph database vendors</p>
</li>
<li>
<p>Gremlin Traversal Language</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">GraphDB</span> - Gremlin</h2>
<div class="ulist">
<ul>
<li>
<p>Way to traverse a graph</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">  // What are the names of Gremlin's friends' friends?
  g.V().has("name","gremlin").
    out("knows").out("knows").values("name")</code></pre>
</div>
</div>
    <aside class="notes">
      * Is part of Tinkerpop
      * Can be directly used within Java
    </aside>
</section>
<section>
<h2><span class="component">Ferma</span> - Intro</h2>
<div class="paragraph">
<p><a href="https://github.com/Syncleus/Ferma" class="bare">https://github.com/Syncleus/Ferma</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Object Graph Mapper library (OGM)</p>
</li>
<li>
<p>Provides Java API to model your Graph Domain using classes</p>
</li>
</ul>
</div>
    <aside class="notes">
        * Maps vertices and edges to Java objects
        * Essentially wraps Tinkerpop elements with custom high level classes
    </aside>
</section>
<section>
<h2><span class="component">Ferma</span> - Mesh Domain Model</h2>
<div class="imageblock">
<div class="content">
<img src="images/domain-model.png" alt="domain model">
</div>
</div>
    <aside class="notes">
    </aside>
</section>
<section>
<h2><span class="component">Ferma</span> - Mesh Domain Model</h2>
<div class="imageblock">
<div class="content">
<img src="images/domain-model-2.png" alt="domain model 2">
</div>
</div>
    <aside class="notes">
    </aside>
</section>
<section>
<h2><span class="component">Ferma</span> - Example</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class User extends AbstractVertexFrame {

  	public String getName() {
		return getProperty("name");
	}

	public List&lt;? extends User&gt; getFriends() {
		return in(KNOWS).has(User.class).toListExplicit(User.class);
	}
}</code></pre>
</div>
</div>
    <aside class="notes">

    </aside>
</section>
<section>
<h2><span class="component">GraphDB</span> - OrientDB</h2>
<div class="ulist">
<ul>
<li>
<p>Java based Graph Database</p>
</li>
<li>
<p>First release in 2010</p>
</li>
<li>
<p>Directly supports Tinkerpop API</p>
</li>
</ul>
</div>
</section>
<section>
<h2><span class="component">GraphDB</span> - Pitfalls</h2>
<div class="ulist">
<ul>
<li>
<p>Running DB embedded is uncommon</p>
</li>
<li>
<p>Transaction handling is still very vendor specific</p>
</li>
</ul>
</div>
</section>
<section>
<h1>Dagger2 - Dependency Injection</h1>
</section>
<section>
<h2><span class="component">Dagger2</span></h2>
<div class="paragraph">
<p><a href="https://google.github.io/dagger/" class="bare">https://google.github.io/dagger/</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dagger is a fully static, compile-time dependency injection framework for both Java.</p>
</li>
<li>
<p>Now maintained by Google (previously Square)</p>
</li>
</ul>
</div>
	<aside class="notes">
      * DI code gets generated
      * DI issues are revealed during compile time
    </aside>
</section>
<section>
<h2><span class="component">Dagger2</span> - Dependency Injection</h2>
<div class="ulist">
<ul>
<li>
<p>Loosely coupled implementations</p>
</li>
<li>
<p>Provide dependencies in your code</p>
</li>
<li>
<p>Manage dependency hierarchies</p>
</li>
</ul>
</div>
	<aside class="notes">
		* Bindings -> Swap Implementation -> Elasticsearch Provider
		* Easier for testing
	</aside>
</section>
<section>
<h2><span class="component">Dagger2</span></h2>
<div class="ulist">
<ul>
<li>
<p>Spring DI vs. Dagger 2</p>
</li>
<li>
<p>Reduced startup time since no complex component-scanning is involved</p>
</li>
</ul>
</div>
    <aside class="notes">
      * Less dependencies
      * Spring DI classpath scanning was very costly
      * Downside: No more dynamic DI injection (-> Plugin System)
    </aside>
</section>
<section>
<h2><span class="component">Dagger2</span> - Java #1</h2>
<div class="paragraph">
<p>The component describes the root of the dependency tree</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Singleton
@Component(modules = { AppModule.class })
public interface AppComponent {

	JsonObject configuration();

	HelloService hello();

	@Component.Builder
	interface Builder {
		@BindsInstance
		Builder configuration(JsonObject configuration);

		AppComponent build();
	}

}</code></pre>
</div>
</div>
    <aside class="notes">
      * Starting point for dagger
      * Builder used to inject already existing dependencies into dagger
    </aside>
</section>
<section>
<h2><span class="component">Dagger2</span> - Java #2</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Singleton
public class HelloService {

	@Inject
	JsonObject configuration;

	@Inject
	public HelloService() {
	}

	public String getResult() {
		return configuration.getString("hello");
	}

}</code></pre>
</div>
</div>
    <aside class="notes">
      * Service is injectable
      * Service has dependencies
    </aside>
</section>
<section>
<h2><span class="component">Dagger2</span> - Java #3</h2>
<div class="ulist">
<ul>
<li>
<p>AppComponent &#8594; DaggerAppComponent (generated)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">JsonObject config = new JsonObject();
config.put("hello", "world");
AppComponent app = DaggerAppComponent.builder()
	.configuration(config)
	.build();

System.out.println(app.hello().getResult());</code></pre>
</div>
</div>
    <aside class="notes">
      * Dagger generates component factory for each found component class
    </aside>
</section>
<section>
<h2><span class="component">Dagger2</span> - Java #4</h2>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.google.dagger&lt;/groupId&gt;
        &lt;artifactId&gt;dagger-compiler&lt;/artifactId&gt;
        &lt;version&gt;${dagger.version}&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.7.0&lt;/version&gt;
            &lt;configuration&gt;
                &lt;verbose&gt;true&lt;/verbose&gt;
                &lt;source&gt;8&lt;/source&gt;
                &lt;target&gt;8&lt;/target&gt;
                &lt;forceJavacCompilerUse&gt;true&lt;/forceJavacCompilerUse&gt;
            &lt;/configuration&gt;
            &lt;dependencies&gt;
                &lt;dependency&gt;
                    &lt;groupId&gt;com.google.dagger&lt;/groupId&gt;
                    &lt;artifactId&gt;dagger-compiler&lt;/artifactId&gt;
                    &lt;version&gt;${dagger.version}&lt;/version&gt;
                    &lt;optional&gt;true&lt;/optional&gt;
                &lt;/dependency&gt;
            &lt;/dependencies&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</section>
<section>
<h2><span class="component">Dagger2</span> - Pitfalls</h2>
<div class="ulist">
<ul>
<li>
<p>IDE integration can be tricky</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/dagger-eclipse-ide.png" alt="dagger eclipse ide">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Code regeneration</p>
</li>
<li>
<p>Source of dagger DI issues sometimes hard to trace</p>
</li>
<li>
<p>DI tree isolated</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">AppComponent app = DaggerAppComponent.builder()
	.configuration(config)
	.build();</code></pre>
</div>
</div>
	<aside class="notes">
        * Dagger code often needs to be fully regenerated
    </aside>
</section>
<section>
<h2>Thank you</h2>
</br></br>
<h3>Examples on Github</h3>
<div class="paragraph">
<p><a href="https://github.com/jotschi/mesh-tech-stack-workshop" class="bare">https://github.com/jotschi/mesh-tech-stack-workshop</a></p>
</div>
<h3>Slides</h3>
<div class="paragraph">
<p><a href="https://jotschi.github.io/mesh-tech-stack-workshop" class="bare">https://jotschi.github.io/mesh-tech-stack-workshop</a></p>
</div>
</section>
	</div>
</div>
</div>
</div>
		<script src="js/head.min.js"></script>
		<script src="js/reveal.js"></script>
		<script src="js/highlight.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
		<script>
			Reveal.initialize({
			center: false,
			transition: "none",
			dependencies: [
				// Speaker notes
				{ src: 'js/plugin/notes/notes.js', async: true }
			]
			
			});

			Reveal.configure({ slideNumber: true });
		</script>
	</body>
</html>